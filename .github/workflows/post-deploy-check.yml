name: Post-Deploy Health Check

on:
  push:
    branches: [main]

jobs:
  verify:
    runs-on: ubuntu-latest
    needs: []  # Run after deployment if you have a deploy job

    steps:
      - name: Wait for deployment
        run: sleep 30

      - name: Check Health Endpoint
        run: |
          curl -f http://44.253.94.252:5000/health || {
            echo "❌ Flask app health endpoint not accessible"
            exit 1
          }

      - name: Check Flask App Home Page
        run: |
          curl -f http://44.253.94.252:5000/ || {
            echo "❌ Flask app home page not accessible"
            exit 1
          }

      - name: Check App Response Content
        run: |
          response=$(curl -s http://44.253.94.252:5000/)
          if [[ $response == *"Task Manager"* ]]; then
            echo "✅ Flask Task Manager is responding correctly"
          else
            echo "❌ Flask app not returning expected content"
            exit 1
          fi